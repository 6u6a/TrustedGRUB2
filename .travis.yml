dist: trusty

sudo: required

git:
  depth: 5

cache:
  ccache: true
  directories:
    - $HOME/.sonar/cache

env:
  matrix:
    - DEFINES="" SONARQUBE="TRUE"
    - DEFINES="CPPFLAGS=-DTGRUB_HP_WORKAROUND" SONARQUBE="FALSE"
    - DEFINES="CPPFLAGS=-DTGRUB_DEBUG" SONARQUBE="FALSE"
  global:
    secure: fsJ8kz9HO/dorxiZDKX3sUJZkQXECKlsZJ6GtoGwJWQyDfZ988msG0alZucRyOHr/3dO4I0UENxIWx4FuKIw1t33ngw2Ugi7muKe53KJJa5iUz0dl8uZ4ndSW45cmF9vvCDAaTRsRITRj4SP275CBO7vs83UhB5yiBwaZAhNwzk=
    secure: VGJSLVGNHvw5v5IbDGnoQB1XMeDpux4qdeirQPGuNECf6aBpeLMKuFbrKxRlg2tMOyo66XL4/dtyTRrSzBmwfgkz94tpd7s8Q13Jb69v8LmSV9bRX5OpR7N06LCEUveJoUdHNI5GOgAxxGGjzRffr1E7SkULqqRV0w9UFrtAIIg=
    secure: Hx9YnkexNql24qktTgsyRIv26SMawkbfJdNeH38h4F3IHoriiiizW9cdcaMSt1z3gnre3oH5sgaU0tQuOiOD9COhfP4BukwkTin6GfFupPPj6PiewlxBAIWdjAosa6Ns3uCWbrbzJ3yLD+qGi509XxM/lJV0RrsJgXIoDQPbpGQ=
compiler: gcc
language: c

before_script:
  - jdk_switcher use oraclejdk8
  - java -version
  # fixme
  - chmod a+x runSonarQubeAnalysis.sh

script:
  - echo ${DEFINES}
  - ./autogen.sh && ./configure --target=i386 -with-platform=pc && make ${DEFINES} -j 2 --silent && ./runSonarQubeAnalysis.sh

os:
  - linux

notifications:
  email:
    recipients:
      - daniel@neus-online.eu
addons:
  apt:
    packages:
      - oracle-java8-installer
  sonarqube: true
  coverity_scan:
    project:
      name: Rohde-Schwarz-Cybersecurity/TrustedGRUB2
      description: Build submitted via Travis CI
    notification_email: daniel@neus-online.eu
    build_command_prepend: "./autogen.sh;./configure --target=i386 -with-platform=pc;make clean"
    build_command: make -j 2 --silent
    branch_pattern: coverity_scan
